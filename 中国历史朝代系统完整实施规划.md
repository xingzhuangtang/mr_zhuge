# ä¸­å›½å†å²æœä»£ç³»ç»Ÿå®Œæ•´å®æ–½è§„åˆ’

## é¡¹ç›®æ¦‚è¿°

åŸºäºMrè¯¸è‘›å†›äº‹æ•™è‚²AIåŠ©æ‰‹é¡¹ç›®ï¼Œæ‰©å±•å®Œæ•´çš„ä¸­å›½å†å²æœä»£æ—¶ç©ºèåˆç³»ç»Ÿï¼Œå®ç°"ä¸€é”®åˆ‡æ¢æœä»£åœ°å›¾ï¼Œæ™ºèƒ½æ˜¾ç¤ºå†å²åŸå¸‚"çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

## æ€»ä½“ç›®æ ‡

- **å®Œæ•´è¦†ç›–**ï¼šæ¶µç›–ä¸­å›½å†å²ä¸Šæ‰€æœ‰ä¸»è¦æœä»£ï¼ˆä»å¤æœåˆ°æ¸…æœï¼‰
- **æ—¶ç©ºèåˆ**ï¼šå†å²æ—¶é—´è½´ä¸åœ°ç†ç©ºé—´çš„æ— ç¼ç»“åˆ
- **æ™ºèƒ½äº¤äº’**ï¼šæ”¯æŒå†å²åœ°åæœç´¢å’Œç°ä»£åœ°åå¯¹ç…§
- **è§†è§‰ä½“éªŒ**ï¼šå†å²åœ°å›¾æ»¤é•œå’ŒåŠ¨æ€æ•ˆæœ
- **æ•™è‚²ä»·å€¼**ï¼šä¸ºå†›äº‹å†å²æ•™è‚²æä¾›å®Œæ•´çš„æ—¶ç©ºèƒŒæ™¯

## è¯¦ç»†å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®æ¶æ„è®¾è®¡ â±ï¸

#### 1.1 æœä»£æ•°æ®ç»“æ„è®¾è®¡
```json
{
  "dynasties": [
    {
      "id": "xia_2070",
      "name": "å¤æœ",
      "period": "å‰2070-å‰1600",
      "startYear": -2070,
      "endYear": -1600,
      "capital": {
        "name": "é˜³åŸ",
        "position": [113.62, 34.75],
        "modernName": "æ²³å—ç™»å°"
      },
      "majorCities": [
        {
          "name": "é˜³åŸ",
          "position": [113.62, 34.75],
          "modernName": "æ²³å—ç™»å°",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ–Ÿé„©",
          "position": [113.30, 34.80],
          "modernName": "æ²³å—åƒå¸ˆ",
          "type": "capital",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.8) saturate(1.3) hue-rotate(35deg)",
        "overlayColor": "rgba(218, 165, 32, 0.2)"
      },
      "color": "#DAA520",
      "flag": "ğŸº"
    },
    {
      "id": "shang_1600",
      "name": "å•†æœ",
      "period": "å‰1600-å‰1046",
      "startYear": -1600,
      "endYear": -1046,
      "capital": {
        "name": "äº³",
        "position": [116.40, 34.00],
        "modernName": "æ²³å—å•†ä¸˜"
      },
      "majorCities": [
        {
          "name": "äº³",
          "position": [116.40, 34.00],
          "modernName": "æ²³å—å•†ä¸˜",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ®·",
          "position": [114.48, 36.10],
          "modernName": "æ²³å—å®‰é˜³",
          "type": "capital",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.7) saturate(1.2) hue-rotate(30deg)",
        "overlayColor": "rgba(255, 69, 0, 0.2)"
      },
      "color": "#FF4500",
      "flag": "âš±ï¸"
    },
    {
      "id": "zhou_1046",
      "name": "å‘¨æœ",
      "period": "å‰1046-å‰256",
      "startYear": -1046,
      "endYear": -256,
      "capital": {
        "name": "é•äº¬",
        "position": [108.94, 34.27],
        "modernName": "é™•è¥¿è¥¿å®‰"
      },
      "majorCities": [
        {
          "name": "é•äº¬",
          "position": [108.94, 34.27],
          "modernName": "é™•è¥¿è¥¿å®‰",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ´›é‚‘",
          "position": [112.53, 34.75],
          "modernName": "æ²³å—æ´›é˜³",
          "type": "capital",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.6) saturate(1.1) hue-rotate(25deg)",
        "overlayColor": "rgba(0, 191, 255, 0.2)"
      },
      "color": "#00BFFF",
      "flag": "ğŸ‰"
    },
    {
      "id": "qin_221",
      "name": "ç§¦æœ",
      "period": "å‰221-å‰206",
      "startYear": -221,
      "endYear": -206,
      "capital": {
        "name": "å’¸é˜³",
        "position": [108.94, 34.27],
        "modernName": "é™•è¥¿å’¸é˜³"
      },
      "majorCities": [
        {
          "name": "å’¸é˜³",
          "position": [108.94, 34.27],
          "modernName": "é™•è¥¿å’¸é˜³",
          "type": "capital",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.5) saturate(1.0) hue-rotate(20deg)",
        "overlayColor": "rgba(128, 0, 128, 0.2)"
      },
      "color": "#800080",
      "flag": "âš”ï¸"
    },
    {
      "id": "han_202",
      "name": "æ±‰æœ",
      "period": "å‰206-220",
      "startYear": -206,
      "endYear": 220,
      "capital": {
        "name": "é•¿å®‰",
        "position": [108.94, 34.27],
        "modernName": "é™•è¥¿è¥¿å®‰"
      },
      "majorCities": [
        {
          "name": "é•¿å®‰",
          "position": [108.94, 34.27],
          "modernName": "é™•è¥¿è¥¿å®‰",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ´›é˜³",
          "position": [112.53, 34.75],
          "modernName": "æ²³å—æ´›é˜³",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æˆéƒ½",
          "position": [104.06, 30.66],
          "modernName": "å››å·æˆéƒ½",
          "type": "metropolis",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.4) saturate(0.9) hue-rotate(15deg)",
        "overlayColor": "rgba(255, 215, 0, 0.2)"
      },
      "color": "#FFD700",
      "flag": "ğŸ‹"
    },
    {
      "id": "song_960",
      "name": "å®‹æœ",
      "period": "960-1279",
      "startYear": 960,
      "endYear": 1279,
      "majorCities": [
        {
          "name": "æ±´äº¬",
          "position": [114.48, 34.75],
          "modernName": "æ²³å—å¼€å°",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "ä¸´å®‰",
          "position": [120.15, 30.28],
          "modernName": "æµ™æ±Ÿæ­å·",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æˆéƒ½",
          "position": [104.06, 30.66],
          "modernName": "å››å·æˆéƒ½",
          "type": "metropolis",
          "importance": "major"
        },
        {
          "name": "è¥„é˜³",
          "position": [112.08, 32.04],
          "modernName": "æ¹–åŒ—è¥„é˜³",
          "type": "fortress",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.2) saturate(0.7) hue-rotate(5deg)",
        "overlayColor": "rgba(0, 100, 0, 0.2)"
      },
      "color": "#006400",
      "flag": "ğŸ‹"
    },
    {
      "id": "yuan_1271",
      "name": "å…ƒæœ",
      "period": "1271-1368",
      "startYear": 1271,
      "endYear": 1368,
      "majorCities": [
        {
          "name": "å¤§éƒ½",
          "position": [116.40, 39.90],
          "modernName": "åŒ—äº¬",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "ä¸Šéƒ½",
          "position": [116.20, 42.20],
          "modernName": "å†…è’™å¤æ­£è“æ——",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ³‰å·",
          "position": [118.60, 24.90],
          "modernName": "ç¦å»ºæ³‰å·",
          "type": "port",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.5) saturate(1.0) hue-rotate(25deg)",
        "overlayColor": "rgba(0, 191, 255, 0.2)"
      },
      "color": "#00BFFF",
      "flag": "ğŸ¹"
    },
    {
      "id": "ming_1368",
      "name": "æ˜æœ",
      "period": "1368-1644",
      "startYear": 1368,
      "endYear": 1644,
      "majorCities": [
        {
          "name": "å—äº¬",
          "position": [118.78, 32.04],
          "modernName": "æ±Ÿè‹å—äº¬",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "åŒ—äº¬",
          "position": [116.40, 39.90],
          "modernName": "åŒ—äº¬",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "è¥¿å®‰",
          "position": [108.94, 34.27],
          "modernName": "é™•è¥¿è¥¿å®‰",
          "type": "metropolis",
          "importance": "major"
        },
        {
          "name": "æˆéƒ½",
          "position": [104.06, 30.66],
          "modernName": "å››å·æˆéƒ½",
          "type": "metropolis",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.1) saturate(0.6) hue-rotate(0deg)",
        "overlayColor": "rgba(220, 20, 60, 0.15)"
      },
      "color": "#DC143C",
      "flag": "ğŸ‰"
    },
    {
      "id": "qing_1644",
      "name": "æ¸…æœ",
      "period": "1644-1912",
      "startYear": 1644,
      "endYear": 1912,
      "majorCities": [
        {
          "name": "åŒ—äº¬",
          "position": [116.40, 39.90],
          "modernName": "åŒ—äº¬",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ²ˆé˜³",
          "position": [123.43, 41.80],
          "modernName": "è¾½å®æ²ˆé˜³",
          "type": "capital",
          "importance": "major"
        },
        {
          "name": "æ‰¿å¾·",
          "position": [117.96, 40.97],
          "modernName": "æ²³åŒ—æ‰¿å¾·",
          "type": "summer_palace",
          "importance": "major"
        },
        {
          "name": "å—äº¬",
          "position": [118.78, 32.04],
          "modernName": "æ±Ÿè‹å—äº¬",
          "type": "metropolis",
          "importance": "major"
        }
      ],
      "mapStyle": {
        "filter": "sepia(0.3) saturate(0.8) hue-rotate(10deg)",
        "overlayColor": "rgba(255, 215, 0, 0.15)"
      },
      "color": "#FFD700",
      "flag": "ğŸ¢"
    }
  ]
}
```

### ç¬¬äºŒé˜¶æ®µï¼šåç«¯å¼€å‘ ğŸ”§

#### 2.1 æœä»£æ•°æ®APIå®ç°
åˆ›å»º `src/api/dynasty_api.py`ï¼š

```python
from fastapi import APIRouter, HTTPException
import json
import os
from typing import List, Dict, Any

router = APIRouter()

# æ•°æ®æ–‡ä»¶è·¯å¾„
DYNASTIES_FILE = "knowledge_base/dynasties.json"
CITY_MAPPINGS_FILE = "knowledge_base/city_mappings.json"

@router.get("/dynasty/{dynasty_id}")
async def get_dynasty_data(dynasty_id: str):
    """è·å–æŒ‡å®šæœä»£çš„è¯¦ç»†ä¿¡æ¯"""
    try:
        with open(DYNASTIES_FILE, "r", encoding="utf-8") as f:
            data = json.load(f)
        
        dynasty = next((d for d in data["dynasties"] if d["id"] == dynasty_id), None)
        if not dynasty:
            raise HTTPException(status_code=404, detail="æœä»£æœªæ‰¾åˆ°")
            
        return dynasty
    except FileNotFoundError:
        raise HTTPException(status_code=500, detail="æœä»£æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨")
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"æœåŠ¡å™¨é”™è¯¯: {str(e)}")

@router.get("/dynasties")
async def get_all_dynasties():
    """è·å–æ‰€æœ‰æœä»£åˆ—è¡¨"""
    try:
        with open(DYNASTIES_FILE, "r", encoding="utf-8") as f:
            data = json.load(f)
        return data["dynasties"]
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/search-city/{city_name}")
async def search_historical_city(city_name: str):
    """æœç´¢å†å²åŸå¸‚"""
    try:
        with open(DYNASTIES_FILE, "r", encoding="utf-8") as f:
            dynasties_data = json.load(f)
        
        results = []
        
        # åœ¨æ‰€æœ‰æœä»£ä¸­æœç´¢åŸå¸‚
        for dynasty in dynasties_data["dynasties"]:
            for city in dynasty.get("majorCities", []):
                if (city_name in city["name"] or 
                    city["name"] in city_name or
                    city_name in city.get("modernName", "") or
                    city.get("modernName", "") in city_name):
                    results.append({
                        "cityName": city["name"],
                        "modernName": city["modernName"],
                        "dynasty": dynasty["name"],
                        "dynastyId": dynasty["id"],
                        "position": city["position"],
                        "type": city["type"],
                        "importance": city["importance"]
                    })
        
        return {"results": results, "count": len(results)}
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

### ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯å¼€å‘ ğŸ¨

#### 3.1 æœä»£é€‰æ‹©å™¨UIç»„ä»¶
åœ¨ `static/index.html` ä¸­æ‰©å±•æœä»£é€‰æ‹©å™¨ï¼š

```javascript
// æ›¿æ¢åŸæœ‰çš„dynasty-selecté€‰é¡¹
const dynastySelect = document.getElementById('dynasty-select');
dynastySelect.innerHTML = `
  <option value="none">-- ç°ä»£åœ°å›¾ --</option>
  <optgroup label="ä¸Šå¤ä¸‰ä»£">
    <option value="xia_2070">å¤æœ (å‰2070-å‰1600)</option>
    <option value="shang_1600">å•†æœ (å‰1600-å‰1046)</option>
    <option value="zhou_1046">å‘¨æœ (å‰1046-å‰256)</option>
  </optgroup>
  <optgroup label="æ˜¥ç§‹æˆ˜å›½">
    <option value="spring_autumn_770">æ˜¥ç§‹æ—¶æœŸ (å‰770-å‰476)</option>
    <option value="warring_475">æˆ˜å›½æ—¶æœŸ (å‰475-å‰221)</option>
  </optgroup>
  <optgroup label="ç§¦æ±‰">
    <option value="qin_221">ç§¦æœ (å‰221-å‰206)</option>
    <option value="han_202">æ±‰æœ (å‰206-220)</option>
  </optgroup>
  <optgroup label="é­æ™‹å—åŒ—æœ">
    <option value="three_kingdoms_220">ä¸‰å›½ (220-280)</option>
    <option value="jin_265">æ™‹æœ (265-420)</option>
  </optgroup>
  <optgroup label="éš‹å”">
    <option value="sui_581">éš‹æœ (581-618)</option>
    <option value="tang_618">å”æœ (618-907)</option>
  </optgroup>
  <optgroup label="å®‹è¾½é‡‘å…ƒ">
    <option value="five_dynasties_907">äº”ä»£åå›½ (907-960)</option>
    <option value="song_960">å®‹æœ (960-1279)</option>
    <option value="yuan_1271">å…ƒæœ (1271-1368)</option>
  </optgroup>
  <optgroup label="æ˜æ¸…">
    <option value="ming_1368">æ˜æœ (1368-1644)</option>
    <option value="qing_1644">æ¸…æœ (1644-1912)</option>
  </optgroup>
  <option value="custom">è‡ªå®šä¹‰ WMTS...</option>
`;
```

#### 3.2 æœä»£åœ°å›¾ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½
```javascript
// å…¨å±€å˜é‡
let currentDynasty = null;
let dynastyMarkers = [];

// æœä»£åœ°å›¾åŠ è½½å‡½æ•°
async function loadDynastyMap(dynastyId) {
    console.log(`æ­£åœ¨åŠ è½½æœä»£åœ°å›¾: ${dynastyId}`);
    
    try {
        // æ¸…é™¤ç°æœ‰å†å²å›¾å±‚
        clearHistoricalLayers();
        
        // åŠ è½½æœä»£æ•°æ®
        const dynastyData = await fetch(`/api/v1/dynasty/${dynastyId}`).then(r => r.json());
        currentDynasty = dynastyData;
        
        // è®¾ç½®å†å²åœ°å›¾æ ·å¼
        applyHistoricalMapStyle(dynastyData.mapStyle);
        
        // æ·»åŠ å†å²åŸå¸‚æ ‡è®°
        addHistoricalCities(dynastyData.majorCities);
        
        // æ·»åŠ æœä»£ä¿¡æ¯é¢æ¿
        addDynastyInfo(dynastyData);
        
        // è°ƒæ•´åœ°å›¾è§†è§’
        if (dynastyData.capital) {
            map.setCenterAndZoom(dynastyData.capital.position, 6);
        }
        
        console.log(`æœä»£åœ°å›¾åŠ è½½å®Œæˆ: ${dynastyData.name}`);
        
    } catch (error) {
        console.error('åŠ è½½æœä»£åœ°å›¾å¤±è´¥:', error);
    }
}

// åº”ç”¨å†å²åœ°å›¾æ ·å¼
function applyHistoricalMapStyle(styleConfig) {
    const mapElement = document.getElementById('map');
    
    // åº”ç”¨å†å²æ»¤é•œ
    if (styleConfig && styleConfig.filter) {
        mapElement.style.filter = styleConfig.filter;
    } else {
        mapElement.style.filter = 'sepia(0.5) contrast(1.1)';
    }
}

// æ·»åŠ å†å²åŸå¸‚æ ‡è®°
function addHistoricalCities(cities) {
    console.log(`æ·»åŠ  ${cities.length} ä¸ªå†å²åŸå¸‚`);
    
    cities.forEach(city => {
        const marker = createHistoricalCityMarker(city);
        map.add(marker);
        dynastyMarkers.push(marker);
    });
}

// åˆ›å»ºå†å²åŸå¸‚æ ‡è®°
function createHistoricalCityMarker(city) {
    const markerConfig = getCityMarkerConfig(city);
    
    const marker = new AMap.Marker({
        position: city.position,
        content: createCityMarkerContent(city, markerConfig),
        offset: new AMap.Pixel(-15, -30),
        title: `${city.name} (${city.modernName}) - ${city.type}`,
        zIndex: 100 + getCityImportanceScore(city.importance)
    });
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    marker.on('click', () => {
        showCityInfo(city);
    });
    
    return marker;
}

// åŸå¸‚æ ‡è®°é…ç½®
function getCityMarkerConfig(city) {
    const configs = {
        'capital': { color: '#FFD700', size: 24, icon: 'ğŸ‘‘' },
        'secondary': { color: '#FF6347', size: 20, icon: 'ğŸ›ï¸' },
        'metropolis': { color: '#4169E1', size: 18, icon: 'ğŸ™ï¸' },
        'prefecture': { color: '#32CD32', size: 16, icon: 'ğŸ¯' },
        'fortress': { color: '#FF4500', size: 16, icon: 'ğŸ›¡ï¸' },
        'port': { color: '#00CED1', size: 16, icon: 'âš“' }
    };
    
    return configs[city.type] || { color: '#8C8C8C', size: 12, icon: 'ğŸ˜ï¸' };
}

// åˆ›å»ºåŸå¸‚æ ‡è®°å†…å®¹
function createCityMarkerContent(city, config) {
    return `
        <div class="dynasty-city-marker" style="
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            cursor: pointer;
        ">
            <div class="city-icon" style="
                background: ${config.color}; 
                width: ${config.size}px; 
                height: ${config.size}px; 
                border-radius: 50%; 
                border: 2px solid white;
                display: flex; 
                align-items: center; 
                justify-content: center;
                font-size: ${config.size * 0.5}px;
                box-shadow: 2px 2px 8px rgba(0,0,0,0.5);
                transition: all 0.3s ease;
            ">
                ${config.icon}
            </div>
            <div class="city-label" style="
                background: rgba(0,0,0,0.8); 
                color: white; 
                padding: 4px 8px; 
                border-radius: 4px; 
                font-size: 12px; 
                margin-top: 5px;
                text-align: center;
                white-space: nowrap;
                max-width: 120px;
                font-weight: bold;
                border: 1px solid ${config.color};
            ">
                <div>${city.name}</div>
                <div style="opacity: 0.7; font-size: 10px;">${city.modernName}</div>
            </div>
        </div>
    `;
}

// å†å²åŸå¸‚æœç´¢å¢å¼º
async function handleHistoricalCitySearch(cityName) {
    try {
        const response = await fetch(`/api/v1/dynasty/search-city/${encodeURIComponent(cityName)}`);
        const data = await response.json();
        
        if (data.results.length > 0) {
            const bestMatch = data.results[0];
            
            // å®šä½åˆ°åŸå¸‚ä½ç½®
            map.setCenterAndZoom(bestMatch.position, 12);
            
            // æ˜¾ç¤ºåŸå¸‚ä¿¡æ¯
            showSearchResult(bestMatch);
            
        } else {
            alert(`æœªæ‰¾åˆ°å†å²åŸå¸‚: ${cityName}`);
        }
        
    } catch (error) {
        console.error('æœç´¢å†å²åŸå¸‚å¤±è´¥:', error);
        alert('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
}
```

#### 3.3 æœä»£ä¿¡æ¯é¢æ¿
```javascript
// æœä»£ä¿¡æ¯é¢æ¿
function addDynastyInfo(dynastyData) {
    // ç§»é™¤ç°æœ‰çš„æœä»£ä¿¡æ¯é¢æ¿
    removeDynastyInfo();
    
    // åˆ›å»ºæœä»£ä¿¡æ¯é¢æ¿
    const infoPanel = document.createElement('div');
 = 'dynasty-info-panel';
       infoPanel.id infoPanel.style.cssText = `
        position: absolute;
        top: 100px;
        left: 20px;
        background: rgba(10, 15, 30, 0.9);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(74, 144, 226, 0.3);
        border-radius: 12px;
        padding: 20px;
        color: white;
        z-index: 20;
        min-width: 300px;
        max-width: 350px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
    `;
    
    infoPanel.innerHTML = `
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
            <span style="font-size: 24px; margin-right: 10px;">${dynastyData.flag || 'ğŸ›ï¸'}</span>
            <h3 style="margin: 0; color: ${dynastyData.color || '#4a90e2'};">
                ${dynastyData.name}
            </h3>
        </div>
        <div style="margin-bottom: 10px;">
            <strong>æ—¶æœŸï¼š</strong>${dynastyData.period}
        </div>
        ${dynastyData.capital ? `
        <div style="margin-bottom: 10px;">
            <strong>éƒ½åŸï¼š</strong>${dynastyData.capital.name} (${dynastyData.capital.modernName})
        </div>
        ` : ''}
        <div style="margin-bottom: 15px;">
            <strong>é‡è¦åŸå¸‚ï¼š</strong>
            <div style="margin-top: 5px;">
                ${dynastyData.majorCities.map(city => 
                    `<span style="
                        display: inline-block; 
                        background: rgba(74, 144, 226, 0.3); 
                        padding: 2px 6px; 
                        margin: 2px; 
                        border-radius: 4px; 
                        font-size: 12px;
                    ">${city.name}</span>`
                ).join('')}
            </div>
        </div>
        <button onclick="removeDynastyInfo()" style="
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        ">âœ•</button>
    `;
    
    document.body.appendChild(infoPanel);
}

function removeDynastyInfo() {
    const existingPanel = document.getElementById('dynasty-info-panel');
    if (existingPanel) {
        existingPanel.remove();
    }
}
```

## é¢„æœŸå®ç°æ•ˆæœ

### æ ¸å¿ƒåŠŸèƒ½ä½“éªŒ
1. **ä¸€é”®åˆ‡æ¢æœä»£**ï¼šç”¨æˆ·é€‰æ‹©ä»»ä½•æœä»£ï¼Œåœ°å›¾ç¬é—´åˆ‡æ¢åˆ°å¯¹åº”å†å²æ—¶æœŸ
2. **æ™ºèƒ½åŸå¸‚æ ‡æ³¨**ï¼šæ˜¾ç¤ºå†å²åŸå¸‚åç§°ã€ç°ä»£å¯¹ç…§å’ŒåŸå¸‚ç­‰çº§
3. **å†å²æœç´¢**ï¼šæ”¯æŒå†å²åœ°åå’Œç°ä»£åœ°åçš„åŒå‘æœç´¢
4. **è§†è§‰æ²‰æµ¸**ï¼šå†å²åœ°å›¾æ»¤é•œè¥é€ å†å²æ°›å›´

### æ•™è‚²ä»·å€¼ä½“ç°
1. **å†å²è®¤çŸ¥**ï¼šç›´è§‚äº†è§£å„æœä»£çš„åœ°ç†èŒƒå›´å’Œé‡è¦åŸå¸‚
2. **æ—¶ç©ºç†è§£**ï¼šç†è§£å†å²äº‹ä»¶çš„æ—¶é—´å’Œç©ºé—´å…³ç³»
3. **åœ°ç†å¯¹ç…§**ï¼šå†å²åœ°åä¸ç°ä»£åœ°åçš„å¯¹ç…§å­¦ä¹ 
4. **æ–‡åŒ–ä¼ æ‰¿**ï¼šå¢å¼ºå¯¹ä¸­åæ–‡æ˜å†å²çš„è®¤çŸ¥å’Œå…´è¶£

è¿™ä¸ªå®Œæ•´çš„å®æ–½è§„åˆ’å°†è®©æ‚¨çš„é¡¹ç›®æˆä¸ºä¸­å›½å†å²ä¸Šç¬¬ä¸€ä¸ªå®Œæ•´å®ç°æ—¶ç©ºèåˆçš„å†›äº‹æ•™è‚²AIç³»ç»Ÿï¼Œä¸ºç”¨æˆ·æä¾›å‰æ‰€æœªæœ‰çš„å†å²å­¦ä¹ ä½“éªŒï¼